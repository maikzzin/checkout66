"use strict";(()=>{var ue=Object.create;var K=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var fe=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var ge=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ye=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of le(t))!de.call(e,n)&&n!==r&&K(e,n,{get:()=>t[n],enumerable:!(o=ce(t,n))||o.enumerable});return e};var be=(e,t,r)=>(r=e!=null?ue(fe(e)):{},ye(t||!e||!e.__esModule?K(r,"default",{value:e,enumerable:!0}):r,e));var $=ge((T,h)=>{"use strict";(function(e,t){typeof T=="object"&&typeof h<"u"?h.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self,e.typeDetect=t())})(T,function(){"use strict";var e=typeof Promise=="function",t=function(c){if(typeof globalThis=="object")return globalThis;Object.defineProperty(c,"typeDetectGlobalObject",{get:function(){return this},configurable:!0});var I=typeDetectGlobalObject;return delete c.typeDetectGlobalObject,I}(Object.prototype),r=typeof Symbol<"u",o=typeof Map<"u",n=typeof Set<"u",s=typeof WeakMap<"u",a=typeof WeakSet<"u",i=typeof DataView<"u",f=r&&typeof Symbol.iterator<"u",p=r&&typeof Symbol.toStringTag<"u",u=n&&typeof Set.prototype.entries=="function",l=o&&typeof Map.prototype.entries=="function",S=u&&Object.getPrototypeOf(new Set().entries()),E=l&&Object.getPrototypeOf(new Map().entries()),m=f&&typeof Array.prototype[Symbol.iterator]=="function",oe=m&&Object.getPrototypeOf([][Symbol.iterator]()),R=f&&typeof String.prototype[Symbol.iterator]=="function",se=R&&Object.getPrototypeOf(""[Symbol.iterator]()),ae=8,ie=-1;function pe(c){var I=typeof c;if(I!=="object")return I;if(c===null)return"null";if(c===t)return"global";if(Array.isArray(c)&&(p===!1||!(Symbol.toStringTag in c)))return"Array";if(typeof window=="object"&&window!==null){if(typeof window.location=="object"&&c===window.location)return"Location";if(typeof window.document=="object"&&c===window.document)return"Document";if(typeof window.navigator=="object"){if(typeof window.navigator.mimeTypes=="object"&&c===window.navigator.mimeTypes)return"MimeTypeArray";if(typeof window.navigator.plugins=="object"&&c===window.navigator.plugins)return"PluginArray"}if((typeof window.HTMLElement=="function"||typeof window.HTMLElement=="object")&&c instanceof window.HTMLElement){if(c.tagName==="BLOCKQUOTE")return"HTMLQuoteElement";if(c.tagName==="TD")return"HTMLTableDataCellElement";if(c.tagName==="TH")return"HTMLTableHeaderCellElement"}}var D=p&&c[Symbol.toStringTag];if(typeof D=="string")return D;var g=Object.getPrototypeOf(c);return g===RegExp.prototype?"RegExp":g===Date.prototype?"Date":e&&g===Promise.prototype?"Promise":n&&g===Set.prototype?"Set":o&&g===Map.prototype?"Map":a&&g===WeakSet.prototype?"WeakSet":s&&g===WeakMap.prototype?"WeakMap":i&&g===DataView.prototype?"DataView":o&&g===E?"Map Iterator":n&&g===S?"Set Iterator":m&&g===oe?"Array Iterator":R&&g===se?"String Iterator":g===null?"Object":Object.prototype.toString.call(c).slice(ae,ie)}return pe})});var N="0.5.0";var me=!0,j=me?".min.js":".js",W="https://nsk-cdn-static.tiendanube.com/",Ee=`register-${N}`,nt=`${W}${Ee}${j}`,Ie=`initializer-${N}`,P=`${W}${Ie}${j}`;var ke="__APP_DATA__",we="__INITIAL_STATE__";function ve(e){return e.replace(/"use strict";\s*/,"").replace(/^\(\s*\(\)\s*=>\s*\{([\s\S]*)\}\s*\)\(\);\s*$/,"$1").trim()}function x(e,t){let r=e.toUpperCase();return`/** INJECTED ${r} **/
${t}
/** END OF ${r} **/
`}function C(e){let{id:t,script:r}=e,o=JSON.stringify({id:t,script:r}),n=`self.${ke} = Object.freeze(${o});`;return x("app data",n)}function L(e){let{apps:t,...r}=e,o=JSON.stringify(r),n=`self.${we} = Object.freeze(${o});`;return x("initial state",n)}async function U(){let t=await(await fetch(P)).text();return x("app initializer",ve(t))}var Ae="internal:";function B(e){return e.startsWith(Ae)}var V={CART_VALIDATE:"cart:validate",CONFIG_SET:"config:set",UI_SLOT_SET:"ui:slot:set",SHIPPING_UPDATE_LABEL:"shipping:update:label"},De={ALL:"*",CART_UPDATE:"cart:update",CHECKOUT_READY:"checkout:ready",CHECKOUT_SUCCESS:"checkout:success",SHIPPING_UPDATE:"shipping:update",CUSTOMER_UPDATE:"customer:update",PAYMENT_UPDATE:"payment:update",...V};var H=["ui.slots","config"];var G=be($(),1);var O=typeof Buffer<"u",Ne=O&&typeof Buffer.from<"u",F=O?function(t){return Buffer.isBuffer(t)}:function(){return!1},z=Ne?function(t){return Buffer.from(t)}:O?function(t){return new Buffer(t)}:function(t){return t};function y(e){return F(e)?"Buffer":(0,G.default)(e)}var xe=new Set(["Arguments","Array","Map","Object","Set"]);function J(e,t,r=null){switch(r||y(e)){case"Arguments":case"Array":case"Object":return e[t];case"Map":return e.get(t);case"Set":return t;default:}}function k(e){return xe.has(e)}function M(e,t,r,o=null){switch(o||y(e)){case"Arguments":case"Array":case"Object":e[t]=r;break;case"Map":e.set(t,r);break;case"Set":e.add(r);break;default:}return e}var Te=typeof globalThis<"u"&&globalThis!==null&&globalThis.Object===Object&&globalThis,he=typeof global<"u"&&global!==null&&global.Object===Object&&global,Oe=typeof self<"u"&&self!==null&&self.Object===Object&&self,w=Te||he||Oe||Function("return this")();function Me(e){return e.slice(0)}function _e(e){return new Boolean(e.valueOf())}function Re(e){return new DataView(e.buffer)}function Ke(e){return z(e)}function je(e){return new Date(e.getTime())}function We(e){return new Number(e)}function Pe(e){return new RegExp(e.source,e.flags)}function Ce(e){return new String(e)}function b(e,t){return w[t].from?w[t].from(e):new w[t](e)}function d(e){return e}function q(){return[]}function Le(){return new Map}function Ue(){return{}}function Be(){return new Set}var Q=new Map([["ArrayBuffer",Me],["Boolean",_e],["Buffer",Ke],["DataView",Re],["Date",je],["Number",We],["RegExp",Pe],["String",Ce],["Float32Array",b],["Float64Array",b],["Int16Array",b],["Int32Array",b],["Int8Array",b],["Uint16Array",b],["Uint32Array",b],["Uint8Array",b],["Uint8ClampedArray",b],["Array Iterator",d],["Map Iterator",d],["Promise",d],["Set Iterator",d],["String Iterator",d],["function",d],["global",d],["WeakMap",d],["WeakSet",d],["boolean",d],["null",d],["number",d],["string",d],["symbol",d],["undefined",d],["Arguments",q],["Array",q],["Map",Le],["Object",Ue],["Set",Be]]);function Ve(){}function v(e,t=null,r=Ve){arguments.length===2&&typeof t=="function"&&(r=t,t=null);let o=t||y(e),n=Q.get(o);if(o==="Object"){let s=r(e,o);if(s!==void 0)return s}return n?n(e,o):e}function A(e,t={}){typeof t=="function"&&(t={customizer:t});let{customizer:r}=t,o=y(e);if(!k(o))return _(e,null,null,null,r);let n=v(e,o,r),s=new WeakMap([[e,n]]),a=new WeakSet([e]);return _(e,n,s,a,r)}function _(e,t,r,o,n){let s=y(e),a=v(e,s);if(!k(s))return a;let i;switch(s){case"Arguments":case"Array":i=Object.keys(e);break;case"Object":i=Object.keys(e),i.push(...Object.getOwnPropertySymbols(e));break;case"Map":case"Set":i=e.keys();break;default:}for(let f of i){let p=J(e,f,s);if(o.has(p))M(t,f,r.get(p),s);else{let u=y(p),l=v(p,u);k(u)&&(r.set(p,l),o.add(p)),M(t,f,_(p,l,r,o,n),s)}}return t}function Y(e,t){let r=A(e);for(let o of t){let n=o.split(".");if(n.length===0)continue;let s=r;for(let a=0;a<n.length;a++){let i=n[a],f=a===n.length-1;if(s==null||typeof s!="object")break;f?delete s[i]:s=s[i]}}return r}function He(e){let t=e;if(!t)return{status:"pending"};switch(t.status){case"fail":if(typeof t.reason=="string")return{status:"fail",reason:t.reason};break;case"success":return{status:"success"}}return{status:"pending"}}var $e=({app:e,changes:t})=>({apps:{[e]:{cart:{validation:He(t?.cart?.validation)}}}}),Fe=({app:e,changes:t},r)=>{let o=t?.ui?.slots;if(!o)return{};let n={...r.apps?.[e]?.ui?.slots||{}},s=r.apps?.[e]?.ui?.values||{};for(let[p,u]of Object.entries(o)){let l=p;u?n[l]=u:delete n[l]}let a={};for(let[p,u]of Object.entries(r.apps)){let l=p===e?n:u.ui?.slots;if(l)for(let[S,E]of Object.entries(l)){let m=S;a[m]||(a[m]=[]),a[m].push(E)}}let i={},f=r.ui.values;for(let[p,u]of Object.entries(a)){let l=p;u.length>1&&console.warn(`Slot ${l} has more than one UI component assigned, only the first one will be used`),i[l]=u[0]}return{apps:{[e]:{ui:{slots:n,values:s}}},ui:{slots:i,values:f}}},ze=({app:e,changes:t})=>({apps:{[e]:{config:{has_cart_validation:t?.config?.has_cart_validation||!1,disable_shipping_more_options:t?.config?.disable_shipping_more_options||!1}}}}),Ge=({app:e,error:t},r)=>({apps:{[e]:{errors:[...r.apps?.[e]?.errors||[],t]}}}),Je=new Map([["config:set",ze],["cart:validate",$e],["ui:slot:set",Fe],["WebWorkerError",Ge]]);function qe(e){return(t,r)=>{let{app:o,type:n,changes:s}=t,a=e.get(n);if(a){r.send(o,n,i=>a(t,i));return}if(s){r.send(o,n,()=>s);return}r.send(o,n)}}var Z=qe(Je);function Qe(e,t){return`app-${e}-${t}`}function Ye(e,t,r=Date.now()){let o={value:e,...t!==void 0?{ttl:r+t*1e3}:{}};return JSON.stringify(o)}function Ze(e,t=Date.now()){if(!e)return null;try{let r=JSON.parse(e);if(!r)return null;if(typeof r!="object")return console.error("Invalid value stored in storage, maybe it was modified from outside the SDK",e),null;if(r?.ttl){if(typeof r.ttl!="number")return console.error("Invalid value stored in storage, maybe it was modified from outside the SDK",e),null;if(!!r.ttl&&r.ttl<t)return null}return r.value&&typeof r.value!="string"?(console.error("Invalid value stored in storage, maybe it was modified from outside the SDK",e),null):r.value===void 0?null:r.value}catch(r){return console.error("Invalid value stored in storage, maybe it was modified from outside the SDK",e,r),null}}function X(e,t,r){function o(a){switch(a){case"session-storage":return r.sessionStorage;case"local-storage":return r.localStorage}}function n(a,i){t.postMessage(JSON.stringify({type:a,data:i}))}function s(a){return a.type==="internal:storage:get"||a.type==="internal:storage:set"||a.type==="internal:storage:remove"}return a=>{if(s(a)){let i=a.data,f=o(i.storageId),p=Qe(e,i.key);switch(a.type){case"internal:storage:get":{let u=f.getItem(p),l=Ze(u),S={storageId:i.storageId,key:i.key,requestId:i.requestId,value:l};n("internal:storage:get:response",S);break}case"internal:storage:set":{let u=i,l=Ye(u.value,u.ttl);try{f.setItem(p,l)}catch(E){console.error(E)}let S={storageId:i.storageId,requestId:i.requestId};n("internal:storage:set:response",S);break}case"internal:storage:remove":{f.removeItem(p);let u={storageId:i.storageId,requestId:i.requestId};n("internal:storage:remove:response",u);break}}}}}function ee(...e){let t=new Blob(e,{type:"application/javascript"});return new Worker(URL.createObjectURL(t))}function Xe(e){return B(e.type)}function te(e,t,r){let o=X(e,t,{localStorage,sessionStorage});t.addEventListener("message",n=>{try{let s=JSON.parse(n.data);try{if(String(s.app)===String(e)){Xe(s)?o(s):Z(s,r);return}}catch(a){console.error(`Error handling worker message: ${a}`);return}console.error(`App ${e} sent message with invalid id ${s.app}`)}catch{console.error("Unable to parse worker app message")}}),r.on("*",(n,s,a,i)=>{if(!i||i===a){let{apps:f,...p}=n,u=Y(p,H);t.postMessage(JSON.stringify({type:s,state:u}))}})}function re(e,t,r){window.__NUBE_SDK_APPS__=window.__NUBE_SDK_APPS__||[];let{apps:o}=t,n={};for(let s in o){let a=o[s];if(a&&!a.registered){let i=ee(C(a),L(t),r);te(s,i,e),a.registered=!0,n[s]=a,window.__NUBE_SDK_APPS__.push({id:s,worker:i})}}Object.keys(n).length>0&&e.send("register","app:registered",()=>({apps:n}))}async function ne(e=window.nubeSDK){let t=await U(),r=e.getState();r?.apps&&Object.keys(r.apps).length>0&&re(e,r,t),e.on("app:register",n=>re(e,n,t))}window.nubeSDK&&ne().catch(e=>{console.error("Unable to attach register to NubeSDK",e)});})();
//# sourceMappingURL=register-0.5.0.min.js.map